<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
	       "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd"
	       [<!ENTITY mdash "&#8212;">]>
<!--
 - Copyright (C) 2014  Internet Systems Consortium, Inc. ("ISC")
 -
 - Permission to use, copy, modify, and/or distribute this software for any
 - purpose with or without fee is hereby granted, provided that the above
 - copyright notice and this permission notice appear in all copies.
 -
 - THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH
 - REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 - AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,
 - INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 - LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
 - OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 - PERFORMANCE OF THIS SOFTWARE.
-->

<refentry id="man.delv">

  <refentryinfo>
    <date>April 23, 2014</date>
  </refentryinfo>

  <refmeta>
    <refentrytitle>delv</refentrytitle>
    <manvolnum>1</manvolnum>
    <refmiscinfo>BIND9</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>delv</refname>
    <refpurpose>DNS查找和验证工具</refpurpose>
  </refnamediv>

  <docinfo>
    <copyright>
      <year>2014</year>
      <holder>Internet Systems Consortium, Inc. ("ISC")</holder>
    </copyright>
  </docinfo>

  <refsynopsisdiv>
    <cmdsynopsis>
      <command>delv</command>
      <arg choice="opt">@server</arg>
      <arg><option>-4</option></arg>
      <arg><option>-6</option></arg>
      <arg><option>-a <replaceable class="parameter">anchor-file</replaceable></option></arg>
      <arg><option>-b <replaceable class="parameter">address</replaceable></option></arg>
      <arg><option>-c <replaceable class="parameter">class</replaceable></option></arg>
      <arg><option>-d <replaceable class="parameter">level</replaceable></option></arg>
      <arg><option>-i</option></arg>
      <arg><option>-m</option></arg>
      <arg><option>-p <replaceable class="parameter">port#</replaceable></option></arg>
      <arg><option>-q <replaceable class="parameter">name</replaceable></option></arg>
      <arg><option>-t <replaceable class="parameter">type</replaceable></option></arg>
      <arg><option>-x <replaceable class="parameter">addr</replaceable></option></arg>
      <arg choice="opt">name</arg>
      <arg choice="opt">type</arg>
      <arg choice="opt">class</arg>
      <arg choice="opt" rep="repeat">queryopt</arg>
    </cmdsynopsis>

    <cmdsynopsis>
      <command>delv</command>
      <arg><option>-h</option></arg>
    </cmdsynopsis>

    <cmdsynopsis>
      <command>delv</command>
      <arg><option>-v</option></arg>
    </cmdsynopsis>

    <cmdsynopsis>
      <command>delv</command>
      <arg choice="opt" rep="repeat">queryopt</arg>
      <arg choice="opt" rep="repeat">query</arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>描述</title>
    <para><command>delv</command>
      (Domain Entity Lookup &amp; Validation，域名实体查找和验证)是一个发送
      DNS请求并验证结果的工具，它使用与<command>named</command>同样的内部解析器
      和验证器逻辑。
    </para>
    <para>
      <command>delv</command>将所有需要获取的请求发向一个指定的名字服务器并
      验证请求到的数据；这包含原始请求，跟随CNAME或DNAME链的后续请求，以及
      为建立一个用于DNSSEC验证的信任链的对DNSKEY，DS和DLV记录的请求。
      它不执行迭代解析，但是模仿一个配置为DNSSEC验证和转发的名字服务器的行为。
    </para>
    <para>
      缺省时，响应使用内置根区（"."）以及ISC DNSSEC后备验证区（"dlv.isc.org"）
      的DNSSEC信任锚点进行验证。<command>delv</command>返回的记录要么是完全
      验证的，要么是没有签名的。如果验证失败，输出中会包含一个对失败的解释；
      验证过程可被详细跟踪。由于<command>delv</command>不依赖一个外部服务器
      来执行验证，它可以用于本地名字服务器不可信的环境中来检查DNS响应的
      有效性。
    </para>
    <para>
      除非其被告知去请求一个特定的名字服务器，<command>delv</command>将试探
      <filename>/etc/resolv.conf</filename>中列出的每个服务器。如果没有发现
      可用的服务器地址，<command>delv</command>将发请求到环回地址（IPv4为
      127.0.0.1，IPv6为::1）。
    </para>
    <para>
      当没有给出命令行参数或选项时，<command>delv</command>将执行对"."（根区）
      的NS查询。
    </para>
  </refsect1>

  <refsect1>
    <title>SIMPLE USAGE</title>

    <para>
      一个典型的<command>delv</command>调用看起来像：
      <programlisting> delv @server name type </programlisting>
      其中:

      <variablelist>
	<varlistentry>
	  <term><constant>server</constant></term>
	  <listitem>
	    <para>
	      是要请求的名字服务器的名字或IP地址。这可以是一个点分十进制表示的
              IPv4地址或一个冒号分隔表示的IPv6地址。当所提供的
              <parameter>server</parameter>参数是一个主机名时，
              <command>delv</command>在请求那个名字服务器之前先解析那个名字
              （注意，那个初始查询<emphasis>不</emphasis>被DNSSEC验证。
	    </para>
	    <para>
	      如果没有提供<parameter>server</parameter>参数，
              <command>delv</command>会查找
              <filename>/etc/resolv.conf</filename>；如果在其中发现一个地址，
              它会请求那个地址上的名字服务器。如果使用了<option>-4</option>
              或<option>-6</option>选项，则只有相关传输协议的地址才会被试探。
              如果没有发现可用的地址，<command>delv</command>将向本地地址（对
              IPv4为127.0.0.1，对IPv6为::1）发送请求。
	      ::1 for IPv6).
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><constant>name</constant></term>
	  <listitem>
	    <para>
	      是被查找的域名。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><constant>type</constant></term>
	  <listitem>
	    <para>
	      指明需要请求那种类型&mdash;ANY，A，MX，等。
              <parameter>type</parameter>可以是任何有效的请求类型。
	      如果没有提供<parameter>type</parameter>参数，
              <command>delv</command>将执行一个对A记录的查找。
	    </para>
	  </listitem>
	</varlistentry>

      </variablelist>
    </para>

  </refsect1>

  <refsect1>
    <title>OPTIONS</title>
    <variablelist>

      <varlistentry>
	<term>-a <replaceable class="parameter">anchor-file</replaceable></term>
	<listitem>
	  <para>
            指定从中读取DNSSEC信任锚点的文件。缺省为
            <filename>/etc/bind.keys</filename>，它被包含在
            <acronym>BIND</acronym> 9中，并含有根区（"."）和ISC DNSSEC后备验证区
            （"dlv.isc.org"）的信任锚点。
	  </para>
	  <para>
	    与根或DLV信任锚点名字不匹配的密钥会被忽略；这些密钥名字可以使用
            <option>+dlv=NAME</option>或者<option>+root=NAME</option>选项
            覆盖。
	  </para>
	  <para>
	    Note: When reading the trust anchor file,
	    <command>delv</command> treats <option>managed-keys</option>
	    statements and <option>trusted-keys</option> statements
	    identically.  That is, for a managed key, it is the
	    <emphasis>initial</emphasis> key that is trusted; RFC 5011
	    key management is not supported. <command>delv</command>
	    will not consult the managed-keys database maintained by
	    <command>named</command>. This means that if either of the
	    keys in <filename>/etc/bind.keys</filename> is revoked
	    and rolled over, it will be necessary to update
	    <filename>/etc/bind.keys</filename> to use DNSSEC
	    validation in <command>delv</command>.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-b  <replaceable class="parameter">address</replaceable></term>
	<listitem>
	  <para>
	    设置请求的源IP地址为<parameter>address</parameter>。这必须是一个
            主机网络接口上的有效地址，或者"0.0.0.0"，或者"::"。
            可以通过附加"#&lt;port&gt;"指定一个可选的源端口。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-c <replaceable class="parameter">class</replaceable></term>
	<listitem>
	  <para>
	    为请求数据设置请求类。当前，在<command>delv</command>中只支持
            类"IN"，任何其它值将被忽略。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-d <replaceable class="parameter">level</replaceable></term>
	<listitem>
	  <para>
	    设置系统范围的调试级别为<option>level</option>。
            允许的范围为0到99.
            缺省是0（关闭调试）。
            调试级别越高，从<command>delv</command>调试跟踪得到的信息越多。
	    参见下列<option>+mtrace</option>，<option>+rtrace</option>和
	    <option>+vtrace</option>选项以获得关于调试的详细信息。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-h</term>
	<listitem>
	  <para>
	    显示<command>delv</command>使用帮助并退出。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-i</term>
	<listitem>
	  <para>
	    非安全模式。这个关闭内部DNSSEC验证。（注意，这不会在向上游
            查询时设置CD位。如果被查询的服务器正在执行DNSSEC验证，它将
            会返回无效数据；这导致<command>delv</command>超时。当必须
            检查无效数据以调试一个DNSSEC问题时，使用
            <command>dig +cd</command>。）
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-m</term>
	<listitem>
	  <para>
	    打开内存使用调试。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-p <replaceable class="parameter">port#</replaceable></term>
	<listitem>
	  <para>
	    指定一个用于请求的目的端口，而不是使用标准的DNS端口号53.这个
            选项用于同一个被配置为在一个非标准端口号监听请求的名字服务器
            通信时。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-q <replaceable class="parameter">name</replaceable></term>
	<listitem>
	  <para>
	    设置请求名为<parameter>name</parameter>。虽然指定请求名可以不需要
            使用<option>-q</option>，但是某些时候必须使用这个选项来将请求名与
            类型和类区别开来（例如，在查找名字"ns"时，可能被错误解释为类型NS，
            或者查找"ch"，可能被错误解释为类CH）。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-t <replaceable class="parameter">type</replaceable></term>
	<listitem>
	  <para>
	    设置请求类型为<parameter>type</parameter>，它可以是除区传送类型
            AXFR和IXFR之外BIND 9所支持的任何有效类型。
	    As with <option>-q</option>, this is useful to distinguish
	    query name type or class when they are ambiguous.
	    在某些时候必须将名字从类型中区别出来。
	  </para>
	  <para>
            缺省请求类型是"A"，除非提供了<option>-x</option>指定一个反向
            查找，这种情况类型是"PTR"。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-v</term>
	<listitem>
	  <para>
            打印<command>delv</command>版本并退出。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-x <replaceable class="parameter">addr</replaceable></term>
	<listitem>
	  <para>
	    Performs a reverse lookup, mapping an addresses to
	    a name.  <parameter>addr</parameter> is an IPv4 address in
	    dotted-decimal notation, or a colon-delimited IPv6 address.
	    When <option>-x</option> is used, there is no need to provide
	    the <parameter>name</parameter> or <parameter>type</parameter>
	    arguments.  <command>delv</command> automatically performs a
	    lookup for a name like <literal>11.12.13.10.in-addr.arpa</literal>
	    and sets the query type to PTR.  IPv6 addresses are looked up
	    using nibble format under the IP6.ARPA domain.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-4</term>
	<listitem>
	  <para>
	    强制<command>delv</command>使用IPv4。
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-6</term>
	<listitem>
	  <para>
	    强制<command>delv</command>使用IPv6。
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>
  </refsect1>

  <refsect1>
    <title>请求选项</title>

    <para><command>delv</command>
      提供一些请求选项，它们影响结果的显式方式，在某些情况它们也影响请求执行
      的方式。
    </para>

    <para>
      Each query option is identified by a keyword preceded by a plus sign
      (<literal>+</literal>).  Some keywords set or reset an
      option.  These may be preceded by the string
      <literal>no</literal> to negate the meaning of that keyword.
      Other keywords assign values to options like the timeout interval.
      They have the form <option>+keyword=value</option>.
      The query options are:

      <variablelist>
	<varlistentry>
	  <term><option>+[no]cdflag</option></term>
	  <listitem>
	    <para>
	      Controls whether to set the CD (checking disabled) bit in
	      queries sent by <command>delv</command>. This may be useful
	      when troubleshooting DNSSEC problems from behind a validating
	      resolver. A validating resolver will block invalid responses,
	      making it difficult to retrieve them for analysis. Setting
	      the CD flag on queries will cause the resolver to return
	      invalid responses, which <command>delv</command> can then
	      validate internally and report the errors in detail.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]class</option></term>
	  <listitem>
	    <para>
	      控制在打印一个记录时是否显示类。缺省是显示类。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]ttl</option></term>
	  <listitem>
	    <para>
	      控制在打印一个记录时是否显示TTL。缺省是显示TTL。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]rtrace</option></term>
	  <listitem>
	    <para>
	      Toggle resolver fetch logging. This reports the
	      name and type of each query sent by <command>delv</command>
	      in the process of carrying out the resolution and validation
	      process: this includes including the original query and
	      all subsequent queries to follow CNAMEs and to establish a
	      chain of trust for DNSSEC validation.
	    </para>
	    <para>
	      This is equivalent to setting the debug level to 1 in
	      the "resolver" logging category. Setting the systemwide
	      debug level to 1 using the <option>-d</option> option will
	      product the same output (but will affect other logging
	      categories as well).
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]mtrace</option></term>
	  <listitem>
	    <para>
	      Toggle message logging. This produces a detailed dump of
	      the responses received by <command>delv</command> in the
	      process of carrying out the resolution and validation process.
	    </para>
	    <para>
	      This is equivalent to setting the debug level to 10
	      for the the "packets" module of the "resolver" logging
	      category. Setting the systemwide debug level to 10 using
	      the <option>-d</option> option will produce the same output
	      (but will affect other logging categories as well).
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]vtrace</option></term>
	  <listitem>
	    <para>
	      翻转验证日志。这显示验证器的内部进程，它决定一个答复是否是
              有效签名、未签名或者无效的。
	    </para>
	    <para>
	      This is equivalent to setting the debug level to 3
	      for the the "validator" module of the "dnssec" logging
	      category. Setting the systemwide debug level to 3 using
	      the <option>-d</option> option will produce the same output
	      (but will affect other logging categories as well).
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]short</option></term>
	  <listitem>
	    <para>
              提供一个简洁的回答。缺省是以冗长形式输出回答。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]comments</option></term>
	  <listitem>
	    <para>
	      翻转在输出中显示注释。缺省是打印注释。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]rrcomments</option></term>
	  <listitem>
	    <para>
	      翻转对输出中每个记录注释的显示状态（例如，关于DNSKEY的人可读
              的密钥信息）。
              缺省是打印每个记录的注释。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]crypto</option></term>
	  <listitem>
	    <para>
	      Toggle the display of cryptographic fields in DNSSEC records.
	      The contents of these field are unnecessary to debug most DNSSEC
	      validation failures and removing them makes it easier to see
	      the common failures.  The default is to display the fields.
	      When omitted they are replaced by the string "[omitted]" or
	      in the DNSKEY case the key id is displayed as the replacement,
	      e.g. "[ key id = value ]".
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]trust</option></term>
	  <listitem>
	    <para>
	      控制在打印一个记录时是否显示信任级别。缺省是显示信任级别。
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]split[=W]</option></term>
	  <listitem>
	    <para>
	      Split long hex- or base64-formatted fields in resource
	      records into chunks of <parameter>W</parameter> characters
	      (where <parameter>W</parameter> is rounded up to the nearest
	      multiple of 4).
	      <parameter>+nosplit</parameter> or
	      <parameter>+split=0</parameter> causes fields not to be
	      split at all.  The default is 56 characters, or 44 characters
	      when multiline mode is active.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]all</option></term>
	  <listitem>
	    <para>
	      Set or clear the display options
	      <option>+[no]comments</option>, 
	      <option>+[no]rrcomments</option>, and
	      <option>+[no]trust</option> as a group.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]multiline</option></term>
	  <listitem>
	    <para>
	      Print long records (such as RRSIG, DNSKEY, and SOA records)
	      in a verbose multi-line format with human-readable comments.
	      The default is to print each record on a single line, to
	      facilitate machine parsing of the <command>delv</command>
	      output.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]dnssec</option></term>
	  <listitem>
	    <para>
	      Indicates whether to display RRSIG records in the
	      <command>delv</command> output.  The default is to
	      do so.  Note that (unlike in <command>dig</command>)
	      this does <emphasis>not</emphasis> control whether to
	      request DNSSEC records or whether to validate them.
	      DNSSEC records are always requested, and validation
	      will always occur unless suppressed by the use of
	      <option>-i</option> or <option>+noroot</option> and
	      <option>+nodlv</option>.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]root[=ROOT]</option></term>
	  <listitem>
	    <para>
	      Indicates whether to perform conventional (non-lookaside)
	      DNSSEC validation, and if so, specifies the
	      name of a trust anchor.  The default is to validate using
	      a trust anchor of "." (the root zone), for which there is
	      a built-in key.  If specifying a different trust anchor,
	      then <option>-a</option> must be used to specify a file
	      containing the key.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><option>+[no]dlv[=DLV]</option></term>
	  <listitem>
	    <para>
	      指示是否执行DNSSEC后备验证，如果执行，就指定DLV信任锚点的名字。
              缺省是使用信任锚点"dlv.isc.org"执行后备验证，对这个锚点存在一个
              内置密钥。如果指定一个不同的名字，就必须使用<option>-a</option>
              指定一个包含DLV密钥的文件。
	    </para>
	  </listitem>
	</varlistentry>
      </variablelist>

    </para>
  </refsect1>

  <refsect1>
    <title>文件</title>
    <para><filename>/etc/bind.keys</filename></para>
    <para><filename>/etc/resolv.conf</filename></para>
  </refsect1>

  <refsect1>
    <title>参见</title>
    <para><citerefentry>
	<refentrytitle>dig</refentrytitle><manvolnum>1</manvolnum>
      </citerefentry>,
      <citerefentry>
	<refentrytitle>named</refentrytitle><manvolnum>8</manvolnum>
      </citerefentry>,
      <citetitle>RFC4034</citetitle>,
      <citetitle>RFC4035</citetitle>,
      <citetitle>RFC4431</citetitle>,
      <citetitle>RFC5074</citetitle>,
      <citetitle>RFC5155</citetitle>.
    </para>
  </refsect1>
</refentry><!--
 - Local variables:
 - mode: sgml
 - End:
-->
